// Copyright (c) 2025-2026 Zack Puhl <github@xmit.xyz>. All rights reserved.
// Use of this source code is governed by the MIT license
// a copy of which can be found in the LICENSE_STDLIB file.
module sha3::parallel_hash_tests @test;

import sha3::tests_common;
import std::hash::sha3::parallel_hash;
import std::hash::sha3::parallel_hash_internal @public;
import std::hash::sha3::cshake;
import std::hash::sha3::nist @public;

import std::math;


// See: https://github.com/usnistgov/ACVP-Server/tree/master/gen-val/json-files/ParallelHash-128-1.0
//   & https://github.com/usnistgov/ACVP-Server/tree/master/gen-val/json-files/ParallelHash-256-1.0
//
//  "internalProjection.json" files.
//
fn void known_vectors_128()
{
	/* tgId  1 - XOF == true */
	/* tcId 53 */ test::@check(parallel_hash::xof_128(336 / 8, x"7908b829c19b5b22e2623d117450ca1a6e67", 16, c: "vsI&I{)#Z)JB$]s[-Wu`hCdE8U!%%={[") == x"bb64392daed1f82bd2fe496da8e47cb25dae3a2fb08298287e9f7d4e0090ce3f88b722b4f285789a6466");
}

fn void known_vectors_256()
{
	/* tgId   1 - XOF == true */
	/* tcId  49 */ test::@check(parallel_hash::xof_256(328 /8, x'72d9baf9dca0aaba0c8fcaa07eb7b0f72e08827d5600eccb93', 13, c: ";Wg}vv:;2n30L9i{*gAE;>In?fHrcu[Fa-g,*,_oTl-U]}! Ry*R]Ry{.w_0NGV<2kN@P]r|(PoM1s2AdH?hk*h.3k|1LOA.5pCpNaNu(,J,bLj9f=J'(n") == x'6467567a4fdc910d988b2f20663c6cb7299b16a2e302a33cc177d48806c108fa45326d97d6399e9b66');
	/* tcId  93 */ test::@check(parallel_hash::xof_256(352 / 8, x'd196755d6f7956c1acbaecc4', 1, c: "2Yi/GZAiuFK:q88|wr`!W!eC=+5!f>-Qw!8qaH!S") == x'1a86a61895b497eca0735d61697aaeddd875ed7b37be1381bed38cbf6d9ba1428d1523950a763cf76c54c662');
	/* tgId   2 - XOF == false */
	static char[] input = x'8c6ef0c2b9629b257fe31b994a42238f3ce0dd798f2a3b1de260f80914d0cb94d344b3fbb729eb43037c055a65af3eeab936b9be2ce6ae3f6aa8eca4a59fa1853e8048892cdcc5f69f0a603d6aa5c6ce049da8b5550a151ccde0d77c208a4d63ba70002c7e438861eb0fc842027b2042250c2ff2025bf63facc6ccb43db106684c62b98be7ebdb3490aa114c49c2e39a95152d26f29ac673fbe8175977180cfd5b1205e516b5585333218cc9cff227c41f44cc49ae627a5148cf40403f0e551c73e03e718703df625fdc886ceb0e423c285767cd347fdd9a838ce9f517b730bc8e78d7122e501c871201c98cfcfede31c558f76fcae4954bf26cc1a48af2632968856bca40089420c731b2cacbd007453173e87be19841f943181ac370e3b9c5cb955c034310a5add3d9080bded8640d30328843b72fbec588aedbe5b668f9cf3d91a22fdd3777b9b7a0aa9f5ecaa81efed12b6ab3f7566ec53a3abbc95c4e7e7866d686f762de5b9d3b3b0e9d8300c369a44204e6723614189992bb9215f5f2ae48235e8d12c340d511dde90b6e0857f6cdd0bf4ffdc69cc46499baa3b46d7a25467da5dbf6913a649201ac0efa78b154357000901b392ceefe541e4c27d2d7beece483205c8d66cd60da8829b59a1982e6e2768b2c660ac99d02685d5e9b3f1a2b62a914fa9736acfb2cf72602c9f067b17de866ed022096f97eb7923962fa57018bf3a602cb00ce48638e4cfd03485594a2bf59f340a51e08acdffb657e0f8a79f4294a1e850971d6dba693202942d8791d1149ec734b2ad6122b0b3cd7a9eff6af753fdcc172a6ebaccc3e6b7b3033b71cd30f6e0639ef33060c912bf51ea31a110f505cf9f44d2c7f5026627f31e2a357005a7ac30106ffd239d10e9f263cd22ebe9c5ed38bb8774dd3700c39c16dd71b305131f1d1d8ae6d24e8b26c9a00ef5d5f24ec08fed4a9314c4c9caf7324baeb3da99f16993253aba55da834e9c39a701f805d7c5815c5d068ca23258453cbcc1c9c2f34700fdebca1451ec3a411fc6f7120023ff0d7876dde0f2577eef4f0c3214c46e6320b9122c04d54e082a3df8d4112197516ec196282624001329e0af526a067849f3d818b96192b093a0acf1f105815f8ea166489d1e524b397273ceb578eea52c2f0e6570b038b7a75ea48a616d7286e8a618410f22a7485958c8e2194a1f382b0e5f638c69f5a6e2756b3456ab9402548d08d4b119a37b928acf66572b3d1292fb35f56fd703f17ac95ab2ae49c328bf100d565cb23350f3cf4a905b70603d38197e29d4531261e35596e46aa73add1b2ae6b758652c11250a488248e75701bdc569e916ee53a5d765bb88c3686b4c418387a2821df291f2951827f8f9d79eee6a4cc5f38c60a2dd68d55af72eb63d22317c2086357bfa8b5d658791210ebcb0b2a789958d8dcda40de7fe188def581ca948f7a6984185e3e253714a14b0b556fdd8e686d2d67b3922b8d7bb5feceeceaf9c41e665aa99992e5c7c08b6e06cd5934e057cbe07b8eb3f5d5131eaa4305e5c283a718658a4f345a48e8bc1ba8673fab26f804b4af6da0dd84f0aadef3dbcd83db34d64579802de40b7b4e1c6b37e67ff212861189c1f759ed92e6b83340d5970427528ee731bdad0a8d75a7c78e6f6aa8dd1fc973d1aa2ec3bd76362d3771802215aadaa28e5d11dbf9e334efba1664c813efa5c1f8adae02f51d444399a6edc16561def2387e9883e0c22080ad23e001bacfd42533e684f49c122126e0f29d1a63e1139b181e98e814d8a77ca14a141644243537c150a378fcf610d066ad5b873ec2cac13a2426ef079575d65f80eaace388d33b79dcdd2ea24ebf3e0d9f7d8aaf06fd8cf7f79e1760ae139e7e46c7bc351d70e4370a8e3b4fc1b9d93c869e1a33f41c263d20c9536c0b4608182cf05c28fcc5abbab17fcb2d3aacc04b0b23a6b72ccb6fa2efb8fac82a96b6d6bb76fc8205e55f2d5546fe63bf16f61a927e02c11cc38f2873610d5bf20001b0e28a4331c753ca0ee4c37abbf3e204fd14ecc92c469960fea7c3d6cff344f0d001f246c3130b075cab495b7dc236ec493101a0e2d103a2284e563cceb0755740413df1df2b35feb5cf9a2fe9c2af54e49286454b84310df3d272f912c0d6f7da321d2c171b7ed0764d2514def7759b4768fca5a750895e6e540d5efcac4cdae379265e5df6bde1372d95d5e39f6100306ea55e9aba7001907b23d4fcb5fe0b2208b440f8a509edc6975f17511ad991280913fab76ee298b91e0367e383789745e6efbc318a0a44695dcc7d52292093e20758754d43f111c5e5ca02e9724a9315b24071adbc98807e613ea980a77e8321edd92e178e4986579d78ca0b89a5a7074c25d0ac4181bc356f0396c949af3db0d58b8f1951e03b83edb22f78cef082f707f32fe52e58ac7df380f7c9cc730accf198fb0b9daefa7c0bff05eefeafb566cd633d537c2f48d0962cc84c5c4682f2a02e2884574f5b4447ab15772943aabbcc53104f65aafb191c525af8f3422720762e31a86b82baddb2a3fe77496523f125bc8e8466f821d2d79406112c0ee746225edc4d35cf785bd87648877dd2ae23648707db884a7e527b6778e3dd9354fa2a7c49f78888792c9716cfe54b9c395078e4a4810911c26c5565d5affc0f72a75c9324b7222607090810ed4ab7d3b8501675f34f3ab08e4e336c1d8f91823d846186b903ed50c56b33df319760f5d872f566323993d32e15971107e8913be93aa84d409046adb748af872369c626603b54aecb7abde5d2a117ffb1a59974f25749f8bec0312d20c0e0ef1f6675451548b6a15c83923233660e71bd676d9838cfed98afdb6f17dcb1325dacf14ce013d4661e3dd244dfeff8d42dd70dde531d8de06b46881a7c67f373a063812b0794e57f9bba8b25193a3320c958d60a505295dfd7f9e0c5927021aa62eb7e1310c22c04e25e30e8fd65d94c0c1b8a9d11565e1f7792ed3498c7ddcca3898af287403b54f5e861af720c71c52d798d703dc433edde06534c1722ec430da2f56f2a07c59a8bc76245443d26cade0457850beb6f99f8b5fa4ddac71c572da5ec98d750ca84fe995cac5d2ca3d8532d13337a1ae9f93bcdbff58cc433e774bf71e71579f8f138d19ff5e5aa66b8ab87110daf91179e8d0212cf4202569e8f4157c3e44e5f643bc2c491b977fb4d9d02f7e262c229cc83553675de34b4fc63586ce1f803baa26974d0d85d9bf4c377f004f6ffb9f7fb2250c79ff1c9d90c9a222dad3a733da1f8f69c5abe4c1c4af5273fb7404f1f9006a75536a4b39906cf8f247ae5eaebb6a845461e49fea277866b538acfa89bbf9c1298262ae5e63f14e65961c4a2b648b10f5fdc0ebba39fcd7f1c8bf2adec28f0e81c9c339dc5072254d9ed9d70f7a2f74637bcd08ca7b9afcbc3f0ed0894eed3f6d2bb45ae8ee9cb3069b674526a916f0994879cc01ec2a3614ac18691388b0b4d40070266ac8bcdd47cef4f4b1afa8c4a8126949f3c13fed422f13a5bbd481fb9028f4df7dcf12f2926d8d31d97c652841d44d957450ddd8dffde58dcb5f3ac500ce6116d7faa8f5b7ddaad19a1fdb27acdef4f6a982ba014fccca16b4cad03d4f1751a4a4020746daf7283e521d959a149a489b8c79ec52731528df3183ecd00bfcff3fa9efc1e56a817085e52d1668ac0baaa19aec2a3e46fb9465f761c85b7d0d6b68864195bf4be377b6b8335e078b204109df69ed776585714f9f0dc8e24838b933349198fd057a0b78539fc3c84b3373c05400843640a00a2f4eab29475bdb567bfba94afee0a51a53902e176fa4bffac85524bd9ea4b4ec8f9079921fcd9ba66aff688845fbd8f5119f38eb2d2f9aa8e0cae6e3023645e483ef36d7d5b6b98c8b5b36fa4da0b5af3836f3d49948cbc6685f58c95a1701a1f9b628fbab112c1573c233f8e602f83994310a13e84f9abcdae1e901dc3d5ebf542d0d45da49e0324adc243405a6a841612506a8d655cef70c03459b4366f1a7f6399f9e54696e9ae9d069a74696c0207d3c78cdd554e8e3bb51af48e4da12b4836adac5c7157dd9f2dbfdbf497a58ab5c2a65561b7502c0ff66a3d2335166e79fb3219f421c4ad2829432e825e85a6f23e2aa4bb1a267b50a2ce211f8006e25b423a793e97c9e067626f8832a0cede188abd291872b0b37470b0be012b0f98b176cf513c9d30b06843176ccd9aeb0060d04d2f19b7592b9376176e4731237ece3d221ea12eae65b9d7e1729d432a8bdff7ef25aaded6d4947080eb02ea8749b5b4b0f726cbf84ff5f70df08bee9c13621a59cf7ad8327e3549e99a7ea45dc7c76d6039568ca538c769fedd5d0c1e7e0bfe8f60b14fb715ee0784cc04bfb9f3d46afcaa6da711f17a0a1e31ee2185ba16ee5937973131c417cde0687d2042e69becfee2c6346d64352791e213cee2cf6f02ec47a555e0d34dc2deda0c47180bec3200d1f0f5bc0335ff8c78057f86f6a7ecaf962b2f189cbeeed88238a264c29f96629ac58abb1f981876bef19ec12645177c7009b8a24ecdc55bac14551cabbe7e17c6a5cb0d235db84ece7ee6621a9aedd7554e2240b65d0766d3ad19d8e7e7f5a453b95c131c6cca93496f0056339809c5ec3c04a162d1d023b8e87aedf002bdcfd519fb235fda1359ef85128781c04f4d9b09daa4b7cabe4edcbced30c6b9185bf6821682e6a5cec7e0bb6c2120ade0a61941a7085db351eb9ce1c92ea1f4145ba633346166688e4311385808b55a30a6ea8f25db15be8e2ae37ceb75e9e0ff39c4217b5153cb353f1cbdc6ecde35688757b30ea12ed97d2284882c9ba7ab01d824363e1ee28859f93054b493e013b310189220eab8237002405ed9adc46593d050a7ff9146801a789ec7c49edcbd805e35f1013a7b528024c8859efc00f7c0f5f290506172e90219cc9c3c39483988de5bdaa5855a8661a108717a499ae614db000dd7649cdc39db775bc0dcf3889543ce38e315d2c102caf4ed3dabc479758d7930c1dd7c56173ef078475c50558e451c3ec20f748e0bc2eb54bab31b2953beb8113282ceb282904857a3de84ed1eafa058d417372e9eabb39090fee75f969456cb4a6f042f9ef156fa3d123abe537b52a213b1bdaa89028137b16ca4d88b856ade9dd7697151b30a91c2c0301fe365fd35d772e50172f4a2b3e056e3a88319ba6e321d2350b02914f8b32f9e2bb5628d951527f245f49dfbc127199a65acbec160ece68170fa125cc9b8d99f6db5cacd7bbc90664479a754b48e1e630df2ccd2539d53f582dd4a257b6c6bed495289df8b278d327f115eb4e1695fbb1f8ec935a522f1f79455f408ef0f77a32e88be14493ef2d62772f54594e84b77e63934f30f9a760766d31d7dfeb5a57456f39c2ce146f45482d9cf1b2a58cab2d3f2bd9483ce97cbb59f5a3d9274aff68e1f9e5f9a1e6aa4ceb8c1a7652ba6c110b0f2aeac3393f453374b4beac20d44803447d019db62c5a169c817c2ea0200ea44009fb8302bd5f0b73bfde30b0e96cf8491672c91051150abded70983ac8f352e57f859dcc9119c74621fedb3707f41d29a6f79382f413d597c8141c74a52d728b1548a4f686af40ba05cd3436acc2d209e53d683b7e683e148c246bd1d3cd0356257809d9fdf2570f3311fb223851bc33f5f041a883a8031f22a2f8edae73cbf0ff7';
	/* tcId 123 */ test::@check(parallel_hash::hash_256(256 / 8, input, 15, c: "UX}Q^ *5J99i1)hQ1Wm4e*?U8Y~^)47X3^u5Qk4!2ry%y5J!ac{B*dGK9H9$ K-7#_VQ2R~EDk!q0:[#0|{D7sOM6J{*Q0!ffc#;") == x'96eb2677296e3150f53a07011b56732c41bdb1130fbf66b8a3002fcf42a20328');
	static char[] input2 = x'abefcb2d0ab44b063c23a3b4a66e7f9f564a1df080076bbb906f75ba6f1268cc494d4e9d20af0310686864353fea5ecd774f5f1d600e18f98decdc0ec4b46fa059e39f053bf6efb6677dfe9901f9a76d7d3a6edfb3c2afe952899410656b8d6602652fe758dc07e52e13df10f76b8221fc4279521b720688caf8e142dc1dc9478df505841aa4b0f78c8951ba4b7ae134cc702e2fb31b5c07ea4a8c08d3946f80cd2a8ad8a04e912a722c6e777af0d25700b5d64b9e977218cea5d2accf2224fb01cbab1ed1e2e9a2bbccc725342bacbdf65b2bf88f714b79485cbb89f14df63952a2a326adc9b22cad65bde910bb75892ec4f9c55c769da5f259e7840f970879b5d8e0a9b5db81f021886e2c173ed230e0ca20fac6ac11324c58022fb9d3b41b92d427e3eb56544fbec0726ea8eafef588a157c3b29a4dddbbccff092b40b193f6171715335ad1388dd3951489cdfe4c622e6f6a67ab32a9e95a3dbd8ee22353d5fc3ba7366023f70cbe6ee5443738f8898eec4e93869032be4e755752def6fcb9d94cc2c688da4e7d03f1f7ddf1f75fb2909b85dedc2d21be012f11afa1fafdb64bd73c97ea882513cb2bc0a84f33ee5f25f84ddcad489016e3ac4fadee19a8c3994611df5784aadd7732276d43046b50ddffc949be97fd5cb7941c94669d45f29804acba84cb5fee420b73aaa547aaff41b54a340c41c8460195abb773ece9ebddcdb5ed04ac062834d58b86defef2624b8f814f8823bf4df2b1678bf394c3cd9251a898aaf68ec204d357cb8fbaf768209f4b37b97c3d85655fe4936e0afc8ba11a41d566130297c63acbc6a825add644d595ef1f64e7d4270facac8e55fdd09a00f03c913b3eb68f6b9ca1506595110c72e86cdb968b9256d211a4ca910262dc1b2b3e36ba482c427186abf73ea639b4763e90b8d9ecc63e27f6d9688027151693dff79e49884b03a045c75ccab94dac7a25f2a619f6bc13ca88be054ccd8738e275b08c53b4d969e4aaae96ff90c6e6fc26360860f78c446c4a5323f12fad4fdbc6ed91a049d2b12d539ea53a285d1dacb035f91d63ffcf0751d6256507bc8350e8be5cae7396311f536b5fc79395426fb82aaeb3fe389a239b04377bf20499b26639cf6accd6d65ee8f855fe226b0b8851176aa06fe989b829298449f51918a96a82339e1d938722cb1d9c87f0c34d204e2c940aae033499d7edfe54f8a27c847f46c2708b59b4e52218a3a38261a5277d7dec729e97ef2cf2bff8d279a93b6ec11fe896ebcb9d3a9e33a29d2f2758d0bf77fd33113da368ddad3b29945318c4b6d2cadb31659e7bb0fdaf4200ccd92de88c26926df1418cfa19fc89464e374e75a26a0854415ce5096a2452c99e82d9378277cba28e6620db1f1c8d4ba7e6d55079e082a510af6058c820d4111dac17a747312d2487c755240f1904a2b4ae293f367075b5292068af9c5369e48b30f524be42f9d1250cc0ee96abc6795ffcab3204604213d0d6ea4002523048b6ecd0d693649f60e02d9f7884468c13616b02cc9b20d05c0689885da2daffc585443522bf27e561c94652d4bc489c59348c1b0117b68deb0e8ffd79c568a732025bc120a0c0a07c6d1a82280bdfeb04024ec64a0d01204665d5e25fa4537b4c6f5eb4a74d9ea8fbd7280338fcf2c1f1efa2cc41b51691b7030ebf48bb77a471527f1acdd0dba6cf907c609eb92355241e9ed749c5cecc8a2b8583f36e397737c6bc5c5217df8fc6eb911081a1bc3c86022d8132af6b2eafd132ac60a19161a0fe025af5aa5752a0d086b4f37d9ebcd8e52485cfd9753a20b207a96980604c9f858e205d9422ab87fd5ba7e98be0b67b9b2cc0ee30e62e1e5fee1856df4ffb786f3fd434195804a613b6b60893990fca5d88b97cd8bcdf59c239b599c8bf3db3643b829bab130455a899ab1040f1581588e0151c0360b3f2db7f481dadad3fbfc6f6faebae98ab72a5bcdc8cafbad90a576347087e04aa5e2631335686a91285255bca1afcaf78cfe99321adbeda240fd6cec7c033651a9110f69b26679405c66a9b67d3c9b0d81f237a6d9895ba55c2589beb8b707c208d2e94cad5cf9b49572bb668149d7caac259383c53f24925dacb6ac2b1eb317dd2af0450737232575fcd60e1ba95202c1a4cd7bcee4fcf917f083c0727fb17b70c71fd34ca97f69916268b2384c82d17d391bec8a33deed0e4cee86a0b497eebf1e5a9e8acf4bed8147bfadc1fb36067724750a5e7089cb659aa2988700b141103abd7e5309f5f2437a5d140f4477a0d5758751f5a8196c8cada880b19f67ee6bbef249ac1b8c0e767ab277ed16791e1b6427feef1d0002745989df187c6cf5e23a2a885293150d64766f05aa9dc6168cb0fd2e854a18963744ecb118f084e5805d05a33cf5cf0892bd4907a34747610aa2dfad61ed52f7dd577e21aba7baad8e124cf1fec0c95c5e5f1be841f5fdb5668868d3ae1307cd4f0463f6522d67be958b0da0fcbde973767db069baa1fc415dd04f036650389bb339afd8344fda1ec8c68a4e474b85b59bcf23d6aecb06feeca8362c3c20752fc954ec82637532aa546f24b190e8f983fc8b33db7ff1e0afcc135d76ea2e7ded881b2740df8230dfaa93d89f7ac3023a2f105aba1dfd3ae095cc14a444ed3e2d0e9f74a32328a4574551d8bae2766bd0c7a254285b8c8cfcce4a6973d97621834ecb15d6a3c9ec8348a636aafa093aff3ffe2a76608ce81476287d0fabecfd8bfcd2b42d65abdee218c4a5439103253b4a0560d6f22e65f2e88b8272bbf547fde9d7ae2f3484f4a0c52c94d68fd090089b38f4f3eae753aaf1f8a26a5c941ead9b3514310bb0644ef94bbe55c967fb9ae5ef16caa2e3230e08a9dfa8c3fdfc83726e3e7b6b85e7b1f397d70de55c54d19176585927810bc9b08fb6e36267e6c05993b22e398d114e383e5baebcd38dcf9d4200bace5627248c78087cd42fe05f4683e1631bf223a22116bf4eb59841b90c8b0352b72d543b06de106d3f3264e77d1146fe9c8a4aa094c7d812913df29cd547bf39076d609d827dfd6692c87a0939407cb83516f0cbc41ab027bad6b90434b325a94bae37f9c97c058d561ecb54ef92f94a3237500af10ae74f573a09980b53856e1d69ac329abeff8511e1c6bb6a0751c47eb467ba114312f7e0c2a8c901277f2cca255c416767fea9f1714e03f2c801fff30abf7a704f9379bb03aa9958e0f66ff5c9836c0754df2e2ed809a4bccdfb9b5c01b9f79764e64d9153a636962d720b260ac1fe635df1ad0256df669d24dd514a40b6cafc1c6ab7c7e6ca0901e1850e3ea6d98a1f45ec02cca613f22cbe345b6ca8182b2ba0b1ff94e1444f60ce532658fc14c17039f9626be27bae1bff990c263ac76507de0a437849c418a847f548542ff1b5ba5a86340d2ff935f42a4958f9ec976606b7564ab1df2c066e068255186fd8555882f8bd90de1c5e28bc12a440221f2aad1da82c855a48a3182702197e11f206ce898b09174473bed3dba50a72442d702000770a6696eed39c0ff2148ce039cdc694e87da23f2b14281eb3643de4a31a3b9f09b7dfb89bb6f72d4832689bcd973fd2ef256e591f29b846c3024de600d4325ab05a776990b5ba46c6b168d36aeb21014a3eb8e574ebf98111706e560dcddea115c386fea87a11a81ad34508aac9c721684ba3ef75582e37491fe3a25dd52a0bba03ad221c995cee2e3e4da32342a0f522cc3b27d998b4c2f5a387f5683fe65886684b4bcee9fd93737d883a1b23dac1154be2442da074055f7c0c0a3cd06ba67868c70e13c641050068d84dae043f01adb4d5c3e65eb14d665f020fff0e0c5bcb263e5a258885fb1fc8a2eefdea64617c0b08393c26dca6b2fc9699b150ddb347d6280275bb0cb5ee01fab305643a0cf8c350ccb14421f338b405324e63fd0a7ba85337e75d24dcc7c97d5e1a055ab82ee4fdbe6b595bab0e0f5f9a87c48f6b6014b8602c58e1e671cc160cef3ff2984e8d06cdcf6d2f24187f90c943a698edd66c9e1c9da94525a2cd1b8a7d742a9ed8a34120b255d7fe314619617e84b39d46937109decb3b8fbdb923a75b507a21e11f5df733ef7157766ce7c938f2ded67476eaf7960bbe269a751023ad5e6b290f52645d6b2804318b17158cf1d604cddcc0f5c6797974456cb92f48110c6e9bf9d99f4db0ab976a3d54611a411adfc9cd21200bea54f2ae9014f8f2924195fc216697c19fc1ef0cdce01b7c18146a65abb189a6f89ff291ab3f1fafb8645a48d0892eab708b8b46d828abece6adddafc4a166ec9a66855002184d1b18c73578ccf219e5b42f0702ae241d8de004a9f84a2866eddd174afa7ee2da878e296ae5b68be1809627d83b9f33f3e550f432ec9fdb4483acebf4be82b00d9c5aa646a2097e8212e149c39ebc13d9d1c5ddaa8c7f252dd4cb7454389ed2ca69b6844f6915c9b30b80a201cdb00ff8012493815d19c410aa1f6c6bbc7a02b4f30773aea424fe75473ab4408fdf4d313730de4b53c5d1dd553864578b10edcfc131e10ae13728ef6ff7473ef719591e76e77caa39d3e6d41264e5dd045e6c9e69bb69e8edb428a3db181f4aa9f4423b1578b5e7af577b3b1acecf09eb03f77f31f12339546e872cdf2bf1b50f01a2d17ec0e0fbdd9e8f9ce4be5764d0f7cfdccd2e4c4cd5c10bf67483863ee46fe962339001bae0c4ad7e3df8fa5064fbb0555ae614f873d671708bc1c07b1ccd95ef0ebc60914d2ac2e216c013473187c8350e92fc7a5ef82ea4214ed5a3a6c44e51403be82d30bee8576063e0a27aa2cf6165773f5b1ee62ae6e9a1403572235607629dfa00e92dac3dee1b6079ef1845717457c70ccba0ff4a3cc14aecfcd662c0eddfbac02443b92c740b0c1e2067b8348e3d0be4e443d72d6e1e44a25a2048ea3980d1a75cc3be803cbb40a2de5d587173a50d35c09c41cf770793d2c3f5e7b4bdda6b78d93bd98b72cc7136035e34f1e1089831e4f6c49509bad3265f214cbdf14401034f497a0bd6e22c85315b8a5a3de2f410a3d908beddbac25347b07daf51b2818da862d4e5194c0afda5925fcc1e1ad6dcc0ae6072d1a976243e9357e1dfd2179117986514bfc4bf145bea6843eef0f69f925d717943a9261d8794a9c85066d80dd64ecd04aa792a4217b42bf7b6fdc8d85ba848b7effddfe4ad1f8dea06c6d877e22f31b7d95237db056167238dc32d058eb09f28deba3d17f69656e2442fa38ee7b9cae3f35798fad127621d15c67b03f1d219ba45b031ad03250f624d18f2677e8cfa08c72ed7986ae4e91067304cf608940b4697220bd1c29202dae003dfca37c95d52cc83980d18b0dc5181f44f15ffef761cd32a30dbdfb69c6f2be04947367b04a6464ce57eb0ee70d7fdeb885f012ecb394b06353c6fa39fa20258eb8988da3d1a434034bb28b1230866907f7f589eb80779d211638547e68b080e3fd3e6d7787d5ae0edc936350b6c79ba84562e97b0322cd260f14787fb21097af0342d9cc2eaf6ae1718d0e4d9dac358fb7078e005f8425d70b9c26f1b61f9beae101fdec5752b0d46249ff29fad8c235052f9e4efb78b1002e301fde83cc2b70b6082660e23bbe56568a78118454082a7aa9bee18f52f30761df2715a9065edb5a837d02033ddfc3112ea0ee8012df5546c8e4e1a886f4340a299dc1fecf84f678f92363a94ef25f8b66678386fe31ffa025e52dfcd6d47ee72751f59d6a2a78b227ecb112807b2cf5e1b87d04db5b5b1f3a2b2848361e65aa36e4257be84143e46c5fe25a503acc4e2e641a3b7fb4cb4cccdedead0ee5110a46014c4cca5a5afcf3fcb9a7a828fd19d9372e4728abac8230efd5423d36e026068b824e53a5865cac42e72c37fc3ca1211ce4ef0c1795c94f9ff250b7063fdb28f1a3e4ca1f35bd263a5fbd75fc2222408d497c120917a96f4c6d8863ac970c005c28591f7c2e6a98f6f823c10415bd2856fd4e123f38514ac261f98aceb41f5e21c28ab94a783ddb5bbb4a5b626cd045f75618cbf52dc2e7e2a497b90ac6544154852ed55bb57e6ec94440011f34ef5a1b035122f673e44f98e66fc9e706209bbd6a8f51c6ec4948790e3fd97d5acd516d7fc02b6212abe3d7f4c2a4fef87d081ebd5bed855cd9db2eb435a157bb445a8a6dc2640f3e59195715aea0c778fdaeb09795c1b458be2fe4d069bc2b02f88595891dfba72da0b37e1046448cbeab987060a45040d9e4a7686992aff2d8299d593b5e73106d0f54e8d59b98002699767f5b9455a052c0f4fd2e68b68188891aa9476b26342bf404b545a301cde1d6d01f14387bf2d2e4c461939f0571c4998bd7697ad6f7b88ab8d78627851621879d33d97b1b136083231d62debee3cb8bddcab923557f09aa9a2f4cdc76f602273f5283d0fca26444fabef9e0a252ba04b3fc1e883e61d92004d61d7f585b411dfd043179e77f88fc52f7842e9f0d81b8afa437b714002c71cb6b4f859eb73c7fec99ed230b69a8ebb433886ad2a48b545cbc3795da2eb7eb283ce2906a3d2fdb6157d22b61dd75e63a12e6cbec54adaefcbac2ce939ed6bfc44f008050e3fd9bfe75be8052870e1e8bca34b1ee7b3b28bd337467d82d5120d725b270fb00b06ec4d446287c6be170219bfce4bfaee577bffc810151c16f459d3beb34f730b987aef360d3f2fb243e34c6294873ee5bc359aaa0b5875f6124a73923a1a916364ae36fd31a713e2160b10960b3e5177ec1dc954a2e7a9df6810dd211135bd64795790e60f1b03758a4d81b527ee16ff6b94d7f77f1abb05943608352cae2fa7b03874223dbd0cb405486f6ded4e05705609cf40ed7dacfd79dea30bdf08cdf9ab7f033d6e6d093ae5b5651c0834d44741e73deaa7db16b375e28f36f7f2797a547792b195575793e4771c042112d00905aafe488312713e209884c5f0eda201b9962ee83de9e2402fc10d2909475bfaa8802499f43310836fc09b87978754e1a0254b8d1d88893a34f27b93a5d10ecc102c5d45df422705134c60c7142732ab54a30a18137c26f5d603ec2b3823cfc097bfbeda32a994aa4d5ef9348e6f3e211db3c765a1967bdf068fff63fc64640c70ef264258406f1c18abbe8f4b3d85d577d89fac3040bfbdf2072a91c5ad45fbee34620434a609ad6007b651547dd62121c51132605240e2e35af861fdcf13cf0d030d115ea79a891afffe8133a308fa791860e96c42fefb55c0abcf2f249d6e88e9f46d684f4982ae7d855f4d96b39f1a17868b2d9cb8f1607560a83a38f6905f4c17f7322301ffa39e8615445f60c678d5f825c4ecaa90d136807a4eed112492c9bebe5d3c75024d4b77d83d8a37e0efbf954b5d996a0dfa7523b7354f4b1b76b3af8c4050760e2155bf2efaa515f4fdb5c99a0887e832460f0ed34aa667fc7a628d438f35a6b949add335dbb01d09486e6d9d4bb58df4073eb1e709cfbc049b8aef17be6e635b53155f968bef6107f61892f6baf387598a3ba1e280f9ce99346f253cb80311eb552880d31f082fb92142e0c858e063b0c7a71ac049b883e3e86e9eaba8924ad6e0fbd72eb45f00950bfbab14dda707d30acddf02ea02e72c4745222fad2bb4cc57be7f60b37e8e96aa04c330e4cb291a9e4bd75d5e9295506c9aad32f5aaa9df3c8fdff6b1962ee21b2d958f5343c6e47817da56fae14c27b53106d250a9c44f842684abbfa1326892d23eaaca5a81637cfdecb9fa3df5b12b8f97f3feb1b459c86fd9e4b733e264d1c484f09277b75d25059415038caf6e1b3bdfa206042d27d2d11281b7b6690112e036a9ac00fcfb31adf82be9872adae191ab2044f545186e21018f72e90b1d218d9c3e6790ffb65c14975b1c9b58d460857ab2d39a9ebf1eae3aabc7491fc8f914b7326b9b605c447ebad3b463b698ccc8d882b20421e8c007c9c7ed442516e84bbed33425ad49182cb705735eb6e87627efec600814b7e7eb6808d47888fb742e226b4c2cc0bcb5389ad6bc19c428109e40764fa9451ab70afff4d26281a303731f4776c786b69e2f85a522dbc2e7d03a7b562b9c7e8375a922c2e36eec4aedbdb27ef1a4628bf46c02be2cbac3d9cde353cead6f50b5f200ebe9437b22a0edb25fe6b590cb33f918b57c4260945182764e160fca0d3da4681fbce86ba4b9e8551eb11c565';
	/* tcId 171 */ test::@check(parallel_hash::hash_256(264 / 8, input2, 7, c: "%1") == x'1d2a7c1b811ff3f61f7686c3ca30223c2d8fc21423b32918953925c2462e47be54');
}

fn void no_remainder()
{
	static char[] data_2 = x'000102030405060710111213141516172021222324252627';
	static char[] data_3 = x'000102030405060708090a0b101112131415161718191a1b202122232425262728292a2b303132333435363738393a3b404142434445464748494a4b505152535455565758595a5b';
	// see Sample #2 from https://csrc.nist.rip/groups/ST/toolkit/documents/Examples/ParallelHash_samples.pdf
	test::@check(parallel_hash::hash_128(256 / 8, data_2, 8, c: "Parallel Data") == x'fc484dcb3f84dceedc353438151bee58157d6efed0445a81f165e495795b7206');
	// Sample #3
	test::@check(parallel_hash::hash_128(256 / 8, data_3, 12, c: "Parallel Data") == x'f7fd5312896c6685c828af7e2adb97e393e7f8d54e3c2ea4b95e5aca3796e8fc');
	// Sample #2, but 512-bit output and 256-bit security strength
	//   the manual, 128-bit-security-strength version of this is done manually within `the_desperation_pays_off`
	test::@check(parallel_hash::hash_256(512 / 8, data_2, 8, c: "") == x'bc1ef124da34495e948ead207dd9842235da432d2bbc54b4c110e64c451105531b7f2a3e0ce055c02805e7c2de1fb746af97a1dd01f43b824e31b87612410429');
	// Sample #2, but high strength w/ a customization string
	test::@check(parallel_hash::hash_256(512 / 8, data_2, 8, c: "Parallel Data") == x'cdf15289b54f6212b4bc270528b49526006dd9b54e2b6add1ef6900dda3963bb33a72491f236969ca8afaea29c682d47a393c065b38e29fae651a2091c833110');
	// Sample #3, high strength
	test::@check(parallel_hash::hash_256(512 / 8, data_3, 12, c: "Parallel Data") == x'69d0fcb764ea055dd09334bc6021cb7e4b61348dff375da262671cdec3effa8d1b4568a6cce16b1cad946ddde27f6ce2b8dee4cd1b24851ebf00eb90d43813e9');
}

fn void simple_remainder()
{
}

// This was the initial test I used to coerce ParallelHash into working (synchronously at first).
fn void the_desperation_pays_off()
{
	// see Sample #1 from https://csrc.nist.rip/groups/ST/toolkit/documents/Examples/ParallelHash_samples.pdf
	char[] x = x"000102030405060710111213141516172021222324252627";
	int b = 8;   // block size of 8
	int l = 256;   // want 32 bytes of hash (not XOF) output

	int n = (int)math::ceil(x.len / (float)b);
	test::@check(n == 3, "invalid block count `n`");

	// This doesn't directly test ParallelHash. Instead, it tests all of the underlying constructs,
	//   and outlines the (simplified) manner by which ParallelHash is able to achieve its goals.
	CShake{128} cs;
	cs.init(PARALLEL_HASH, "");

	cs.update(nist::encode_length(LEFT, b, true));
	test::@check(x"0108" == nist::encode_length(LEFT, b, true), "Raw-byte `block_size` (b) should be `01 08`");

	// in the "real" PH, these are computed in parallel and converge in order at the end of all thread joins
	cs.update(cshake::xof(128, 32, x[:8])[..]);   // block 0
	test::@check(cshake::xof(128, 32, x[:8]) == x"2EA7A0601B9C5CB41E469F854077C1E33AAC94D39CE46163429ABCACFA992BBC", "Invalid first XOF output");

	cs.update(cshake::xof(128, 32, x[8:8])[..]);   // block 1
	test::@check(cshake::xof(128, 32, x[8:8]) == x"49867B4E0D7BA344078EEDE9BD7E8421679DED282A0E50CEE8F118361C087595", "Invalid second XOF output");

	cs.update(cshake::xof(128, 32, x[16:8])[..]);   // block 2
	test::@check(cshake::xof(128, 32, x[16:8]) == x"E68984758EE83E4B3F437C58625DA0CDE3EE6B06BF30F0F63DFF3915A5518FC8", "Invalid third XOF output");

	cs.update(nist::encode_length(RIGHT, n, true));
	test::@check(x"0301" == nist::encode_length(RIGHT, n, true), "Raw-byte encoded block count (n) should be `03 01`");

	cs.update(nist::encode_length(RIGHT, l / 8));
	test::@check(x"010002" == nist::encode_length(RIGHT, l / 8), "Raw-byte encoded output length (L) should be `01 00 02`");

	char[256 / 8] out; cs.final(out[..]);
	test::@check(x"ba8dc1d1d979331d3f813603c67f72609ab5e44b94a0b8f9af46514454a2b4f5" == out, "Invalid final ParallelHash128 (non-XOF) value");
}

// fn void empty()
// {
// }

// fn void interval()
// {
// }

// fn void streamed()
// {
// }

// fn void large() @if ($feature(SLOW_TESTS))
// {
// }

// fn void successive_xof_operations_128()
// {
// }

// fn void successive_xof_operations_256()
// {
// }

// All things equal, a HASH and an XOF result are NOT THE SAME.
fn void xof_vs_non_xof()
{
	test::ne(
		parallel_hash::xof_128 (336 / 8, x"7908b829c19b5b22e2623d117450ca1a6e67", 16, c: "vsI&I{)#Z)JB$]s[-Wu`hCdE8U!%%={["),
		parallel_hash::hash_128(336 / 8, x"7908b829c19b5b22e2623d117450ca1a6e67", 16, c: "vsI&I{)#Z)JB$]s[-Wu`hCdE8U!%%={[")
	);
	test::ne(
		parallel_hash::xof_256 (336 / 8, x"7908b829c19b5b22e2623d117450ca1a6e67", 16, c: "vsI&I{)#Z)JB$]s[-Wu`hCdE8U!%%={["),
		parallel_hash::hash_256(336 / 8, x"7908b829c19b5b22e2623d117450ca1a6e67", 16, c: "vsI&I{)#Z)JB$]s[-Wu`hCdE8U!%%={[")
	);
}










// Copyright (c) 2025-2026 Zack Puhl <github@xmit.xyz>. All rights reserved.
// Use of this source code is governed by the MIT license
// a copy of which can be found in the LICENSE_STDLIB file.
module sha3::tests_common;

// Should be common to every SHA-3 test module. See 'generator.py'
const String[] SIMPLE_VECTORS =
{
	"123",
	"abcdefghijklmnopqrstuvwxyz",
	"ABCDEFGHIJKLMNOPQRSTUVWXYZ",
	"The quick brown fox jumps over the lazy dog",
	"C3 is a great and acquirable language. I recommend it to everyone I know who is doing"
		" systems programming and could use something fresh that doesn't force them into"
		" strange or otherworldly syntax, just for the sake of pretentiousness.",
};

const String[] CUSTOMIZATION_STRINGS =
{
	"",
	"email signature",
	"my customization string that is a bit longer",
};

const String[] KMAC_KEYS =
{
	"correct horse battery staple cryptographic brainrot",
	"RJ5r5ToA9N9~Y-,kin8y]xB}kviaDk_kPI",
};

const String STREAM_VECTOR =
	"This Standard specifies the Secure Hash Algorithm-3 (SHA-3) family of"
	" functions on binary data. Each of the SHA-3 functions is based on an instance"
	" of the KECCAK algorithm that NIST selected as the winner of the SHA-3"
	" Cryptographic Hash Algorithm Competition. This Standard also specifies the"
	" KECCAK-p family of mathematical permutations, including the permutation that"
	" underlies KECCAK, in order to facilitate the development of additional"
	" permutation-based cryptographic functions. The SHA-3 family consists of four"
	" cryptographic hash functions, called SHA3-224, SHA3-256, SHA3-384, and SHA3-512,"
	" and two extendable-output functions (XOFs), called SHAKE128 and SHAKE256. Hash"
	" functions are components for many important information security applications,"
	" including 1) the generation and verification of digital signatures, 2) key"
	" derivation, and 3) pseudorandom bit generation. The hash functions specified in"
	" this Standard supplement the SHA-1 hash function and the SHA-2 family of hash"
	" functions that are specified in FIPS 180-4, the Secure Hash Standard."
	" Extendable-output functions are different from hash functions, but it is possible"
	" to use them in similar ways, with the flexibility to be adapted directly to the"
	" requirements of individual applications, subject to additional security considerations.";

macro get_bigboi()
{
	// 100 million 'a' characters
	char[] bigboi = mem::talloc_array(char, 1_000_000);
	bigboi[..] = 'a';
	return bigboi;
}
